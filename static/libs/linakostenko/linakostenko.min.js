!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.LinaKostenko=n()}(this,function(){"use strict";var e="абвгґдеєжзиіїйклмнопрстуфхцчшщьюяўэыАБВГҐДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯЎЭЫabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPGRSTUVWXYZ",n=["!!!",".","!","?","…"],r=["\n","\r"," "],t=/(?:<\w+[\s\w\d=\-.,+;"':/]*>|<\/\w+>)/g,o="%HTML%",c=[{symbol:'"',code:"&quot;"},{symbol:"…",code:"&hellip;"},{symbol:"&",code:"&amp;"},{symbol:"<",code:"&lt;"},{symbol:">",code:"&gt;"},{symbol:"«",code:"&laquo;"},{symbol:"»",code:"&raquo;"},{symbol:"„",code:"&bdquo;"},{symbol:"“",code:"&ldquo;"},{symbol:" ",code:"&nbsp;"},{symbol:"¢",code:"&cent;"},{symbol:"£",code:"&pound;"},{symbol:"¤",code:"&curren;"},{symbol:"¥",code:"&yen;"},{symbol:"§",code:"&sect;"},{symbol:"©",code:"&copy;"},{symbol:"®",code:"&reg;"},{symbol:"°",code:"&deg;"},{symbol:"±",code:"&plusmn;"},{symbol:"€",code:"&euro;"},{symbol:"—",code:"&mdash;"}];var i='"',u=["«","»"],a=["„","“"];function s(e,t){var o=t.outer,c=t.inner;return function(e){for(var t=[],o=e.length,c=0,i=!1,u=0;u<o;u+=1){var a=e[u],s=e[u-1];'"'===a&&(i=!i),(r.includes(a)&&n.includes(s)||u===o-1)&&!i&&(t.push(e.slice(c,u+1)),c=u+1)}return t}(e).map(function(e){return function e(n,r){var t=r.outer,o=r.inner,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=n.indexOf(i),a=n.lastIndexOf(i);if(-1===u||-1===a)return n;var s=n.slice(0,u),l=n.slice(u+1,a),p=n.slice(a+1),f=c?o:t;return s+f[0]+e(l,{inner:o},!0)+f[1]+p}(e,{outer:o,inner:c})}).join("")}var l={forceSpaceAfterPunctuation:function(n){return n.replace(new RegExp("([абвгґдеєжзиіїйклмнопрстуфхцчшщьюяўэыАБВГҐДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯЎЭЫabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPGRSTUVWXYZ0123456789]+)([,!.:?;])(["+e+"]+?)","g"),"$1$2 $3")},normalizeSeriesOfExclamationMarks:function(e){return e.replace(/!{2,}/g,"!!!")},normalizeSeriesOfQuestionMarks:function(e){return e.replace(/\?{2,}/g,"???")},replaceHyphensInDateRangesWithLongDashes:function(e){return e.replace(/(\d{4})-(\d{4})/g,"$1&mdash;$2")},replaceHyphensWithLongDashes:function(e){return e.replace(new RegExp("(^|[\n"+o+"])- ?","g"),"$1—&nbsp;").replace(/ - /g,"&nbsp;— ")},replaceSeriesOfDotsWithEllipsis:function(e){return e.replace(/\.{2,}/g,"…")},replaceSeriesOfSpacesWithOneSpace:function(e){return e.replace(/ {2,}/g," ")},replaceStraightQuotationMarks:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=void 0,t=void 0;return n.outer&&n.inner?(r=n.outer,t=n.inner):n.outer?(r=n.outer,t=n.outer):(r=u,t=a),s(e,{inner:t,outer:r})},replaceHTMLCodesWithSpecialSymbols:function(e){return c.reduce(function(e,n){var r=n.symbol,t=n.code;return e.replace(new RegExp(""+t,"g"),r)},e)},replaceSpecialSymbolsWithHTMLCodes:function(e){return c.filter(function(e){var n=e.symbol;return" "!==n&&"&"!==n}).reduce(function(e,n){var r=n.symbol,t=n.code;return e.replace(new RegExp(""+r,"g"),t)},e)},forceNonBreakingSpaceAroundLongDashes:function(e){return e.replace(/ —/g,"&nbsp;—").replace(new RegExp("(^|[\n"+o+"])— ?","g"),"$1—&nbsp;")}},p=function(e){for(var n=void 0,r=[],o=[];n=t.exec(e);){var c=n.index,i={begin:c,end:c+n[0].length,type:"html",content:n[0]};o.push(i)}for(var u=0,a=0,s=function(n){var t=o.find(function(e){return n>=e.begin&&n<e.end});t?(a=n,r.push({begin:u,end:a,type:"text",content:e.slice(u,a)}),n=t.end-1,u=t.end):n===e.length-1&&(a=e.length,r.push({begin:u,end:a,type:"text",content:e.slice(u,a)})),l=n},l=0;l<e.length;l+=1)s(l);return[].concat(o).concat(r).filter(function(e){return e.begin<e.end}).sort(function(e,n){return e.begin>n.begin?1:e.begin<n.begin?-1:0})};var f=["replaceHTMLCodesWithSpecialSymbols","replaceSeriesOfDotsWithEllipsis","normalizeSeriesOfExclamationMarks","normalizeSeriesOfQuestionMarks","forceSpaceAfterPunctuation","forceNonBreakingSpaceAroundLongDashes","replaceSeriesOfSpacesWithOneSpace","replaceHyphensWithLongDashes","replaceHyphensInDateRangesWithLongDashes","replaceStraightQuotationMarks"];function d(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l[e];if(!r)throw new Error('Rule "'+e+"\" doesn't exist.");return n.ignoreHTML?r:function(e){return function(n){for(var r=arguments.length,t=Array(r>1?r-1:0),c=1;c<r;c++)t[c-1]=arguments[c];var i=p(n),u=i.map(function(e){return"html"===e.type?o:e.content}).join(""),a=e.apply(void 0,[u].concat(t));return i.filter(function(e){return"html"===e.type}).map(function(e){return e.content}).reduce(function(e,n){return e.replace(o,n)},a)}}(r)}var g=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";var r=Object.keys(n).filter(function(e){return!1===n[e]});return f.filter(function(e){return!r.includes(e)}).map(function(e){return d(e,n)}).reduce(function(e,n){return n(e)},e)};return Object.keys(l).forEach(function(e){g[e]=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d(e,r)(n)}}),g});
